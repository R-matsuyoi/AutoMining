
                   ###################################################################### 加工训练账期近n月基础数据
                    
20220627-10:26:18  开始时间：2022-06-27 10:26:18
20220627-10:26:18  ---- month: 202010
20220627-10:26:18  ---- 参数设置：
                       ---- step: train
                       ---- Info.model_name: 模型示例
                       ---- Info.n_recent: 3
                       ---- Info.Pcase_limit: 1000
                       ---- Info.traintable_ratio: 2
                       ---- Info.Pcumsum_limit: 2
                       ---- Info.timein_count: 500

                   ------------------------------------- 检查各前置表 --------------------------------------------------- 
20220627-10:26:18  检查 kehujingyingbudb.ml_xy_eg_m
20220627-10:26:18      78 列
20220627-10:26:18      202010账期： 15000行
20220627-10:26:18      202009账期： 18000行
20220627-10:26:18      202008账期： 10000行


20220627-10:26:18  正负例分布：select cast(flag_eg as text) flag_eg, count(1) from kehujingyingbudb.ml_xy_eg_m  group by flag_eg
20220627-10:26:18      dis_train_total: {'count': 68000, 'Pcount': 8036, 'prop': 0.118}



20220627-10:26:19  ---- 建表语句（限定202010账期当月目标用户）：
                       drop table if exists kehujingyingbudb.mid_eg_model_train_202010;
                       select pg_sleep(5);
                       create  table kehujingyingbudb.mid_eg_model_train_202010 as 
                       select acct_month, user_id, flag_eg ,row_number() over(order by acct_month desc, random()) rnself 
                       from kehujingyingbudb.ml_xy_eg_m
                       where acct_month>=202008 and acct_month<=202010 and user_status='在网-正常' and 
                           phone_no_null is null and
                           last_stop_date is not null and
                           innet_months >= 3 
                        and flag_eg is not null;
20220627-10:26:24      sql执行完毕
20220627-10:26:24  统计kehujingyingbudb.mid_eg_model_train_202010行列数
20220627-10:26:24      行数：{'202009': 15048, '202010': 12449}
                       列数：4


20220627-10:26:24  ---- 建表语句（划分训练/验证数据集）：
                       drop table if exists kehujingyingbudb.mid_eg_user_train_202010;
                       create  table kehujingyingbudb.mid_eg_user_train_202010 as 
                       (select acct_month user_acct_month, 'data_timein' data_use, * from kehujingyingbudb.mid_eg_model_train_202010 where rnself <= 500)
                       union all
                       (select acct_month user_acct_month, 'data_train'  data_use, * from kehujingyingbudb.mid_eg_model_train_202010 where rnself > 500 and flag_eg=1 order by rnself limit 1000)
                       union all
                       (select acct_month user_acct_month, 'data_train'  data_use, * from kehujingyingbudb.mid_eg_model_train_202010 where rnself > 500 and flag_eg=0 order by rnself limit 2000) ;
20220627-10:26:24      sql执行完毕
20220627-10:26:24  正负例分布：select cast(flag_eg as text) flag_eg, count(1) from kehujingyingbudb.mid_eg_user_train_202010  group by flag_eg
20220627-10:26:24      dis_train_sample {'count': 3500, 'Pcount': 1064, 'prop': 0.304}



20220627-10:26:24  ---- 关联近n月数据：
                       drop table if exists kehujingyingbudb.mid_eg_recent_train_202010;
                       create  table kehujingyingbudb.mid_eg_recent_train_202010 as
                       select user_acct_month, data_use, acct_month, phone_no_null, phone_no_tm, user_id, dinner_id, account_id, innet_date, innet_months, age, sex, age_add, sex_add, user_status, last_stop_date, dinner, dinner_fee, gprs_last_defer, gprs_resource, gprs_now_rest, call_use, if_nolimit, if_5g_dinner, if_5g_term, if_jt, start_level, cred_type, if_cred_multi, arpu, pay_cnt, pay_fee, acct_balance, term_model, term_brand, term_type, sk_type, if_new_term, calling_cnt, calling_dura, called_cnt, called_dura, calling_diff_cnt, calling_diff_dura, gprs_flow, gprs_flow_4g, gprs_flow_5g, gprs_flow_busy, gprs_flow_idle, gprs_now_defer, gprs_flow_roam, call_dura_roam, days_roam, gprs_flow_gat, days_gat, days_gprs, days_call, nos_call, nos_calling, nos_calling_diff, sms_cnt, call_fee_local, call_fee_roam, gprs_income, gprs_fee, call_fee, gprs_flow_video, gprs_flow_short, gprs_flow_music, gprs_flow_commu, gprs_flow_game, dayvalue_calling_dura, dayvalue_gprs_flow, dayvalue_user_status, dayvalue_phone_no_null, flag_eg, score_flag_eg, score_flag_eg2 
                       from (
                       select a.user_acct_month, a.data_use, b.*
                       from (select * from kehujingyingbudb.mid_eg_user_train_202010 where data_use='data_timein') a
                       inner join (select * from kehujingyingbudb.ml_xy_eg_m where acct_month>=202008 and acct_month<=202010) b on a.user_id = b.user_id
                       union all 
                       select a.user_acct_month, a.data_use, b.*
                       from (select * from kehujingyingbudb.mid_eg_user_train_202010 where data_use='data_train' and acct_month=202008) a
                       inner join (select * from kehujingyingbudb.ml_xy_eg_m where acct_month>=202006 and acct_month<=202008) b on a.user_id = b.user_id
                       union all
                       select a.user_acct_month, a.data_use, b.*
                       from (select * from kehujingyingbudb.mid_eg_user_train_202010 where data_use='data_train' and acct_month=202009) a
                       inner join (select * from kehujingyingbudb.ml_xy_eg_m where acct_month>=202007 and acct_month<=202009) b on a.user_id = b.user_id
                       union all
                       select a.user_acct_month, a.data_use, b.*
                       from (select * from kehujingyingbudb.mid_eg_user_train_202010 where data_use='data_train' and acct_month=202010) a
                       inner join (select * from kehujingyingbudb.ml_xy_eg_m where acct_month>=202008 and acct_month<=202010) b on a.user_id = b.user_id
                       ) t;
20220627-10:26:25      sql执行完毕
20220627-10:26:25  统计kehujingyingbudb.mid_eg_recent_train_202010行列数
20220627-10:26:25      9314行，78列

                   --------------------------------- 核验各账期数据量  ---------------------------------------------- 
20220627-10:26:25  sql语句：
                       select user_acct_month, data_use, acct_month, flag_eg, count(1) 
                       from kehujingyingbudb.mid_eg_recent_train_202010 
                       group by user_acct_month, data_use, acct_month, flag_eg 
                       order by user_acct_month, data_use, acct_month, flag_eg

20220627-10:26:25  结果：
                      user_acct_month     data_use  acct_month  flag_eg  count
                   0           202010  data_timein      202008      NaN    343
                   1           202010  data_timein      202009      0.0    436
                   2           202010  data_timein      202009      1.0     64
                   3           202010  data_timein      202010      0.0    436
                   4           202010  data_timein      202010      1.0     64
                   5           202010   data_train      202008      NaN   1971
                   6           202010   data_train      202009      0.0   2000
                   7           202010   data_train      202009      1.0   1000
                   8           202010   data_train      202010      0.0   2000
                   9           202010   data_train      202010      1.0   1000


D:\工作\模型脚本\ModelProject\selfmodule\tablemodule\tablefun.py:900: UserWarning: 下列账期用户量不同，请检查！
                             acct_month  flag_eg  count
user_acct_month data_use                               
202010          data_timein      202008      0.0    343
                data_timein      202009      1.0    500
                data_timein      202010      1.0    500
                data_train       202008      0.0   1971
                data_train       202009      1.0   3000
                data_train       202010      1.0   3000
  warnings.warn(w); time.sleep(seconds)
20220627-10:26:28  
                   ---- 删除中间表
20220627-10:26:28  drop table if exists kehujingyingbudb.mid_eg_model_train_202010;
20220627-10:26:28      sql执行完毕
20220627-10:26:28  drop table if exists kehujingyingbudb.mid_eg_user_train_202010;
20220627-10:26:28      sql执行完毕

20220627-10:26:28  ---- 返回结果表名：kehujingyingbudb.mid_eg_recent_train_202010
20220627-10:26:28  ---- 将Info保存至./binaryclassify/eg/traintest~202010~202012/Info~base_train.pkl

20220627-10:26:28  结束时间：2022-06-27 10:26:28
20220627-10:26:28  耗时：10 s

                   ###################################################################### 探索模型宽表
                    
20220627-10:28:37  开始时间：2022-06-27 10:28:37
20220627-10:28:37  参数设置：
                       step: train
                       stage: explore
                       Info.r_limit: 0.95
                       table_in: kehujingyingbudb.mid_eg_recent_train_202010
                       Info.iv_limit: 0.05
                       Info.auto_pair2: False
                       Info.model_name: 模型示例

20220627-10:28:37  field_base: 92行

20220627-10:28:37  删除7个available_notzd“不可用”字段：['cred_type', 'called_dura', 'days_roam', 'dayvalue_calling_dura', 'dayvalue_gprs_flow', 'dayvalue_user_status', 'dayvalue_phone_no_null']
20220627-10:28:37  field_base: 85行

20220627-10:28:37  删除1个基于“不可用”字段加工的手动衍生_py字段：
                        field_name                 formula
                   54  days_roam_p  days_roam / days_month
20220627-10:28:37  field_base: 84行
20220627-10:28:37  ------------------------- 读取数据: kehujingyingbudb.mid_eg_recent_train_202010 2022-06-27 10:28:37 -------------------------
20220627-10:28:37      src: gp
20220627-10:28:37      condition: data_use='data_train'
20220627-10:28:37      col_need(71): ['user_acct_month', 'data_use', 'acct_month', 'user_id', 'innet_months', 'age', 'age_add', 'dinner_fee', 'gprs_last_defer', 'gprs_resource', 'gprs_now_rest', 'call_use', 'arpu', 'pay_cnt', 'pay_fee', 'acct_balance', 'calling_cnt', 'calling_dura', 'called_cnt', 'calling_diff_cnt', 'calling_diff_dura', 'gprs_flow', 'gprs_flow_4g', 'gprs_flow_5g', 'gprs_flow_busy', 'gprs_flow_idle', 'gprs_now_defer', 'gprs_flow_roam', 'call_dura_roam', 'gprs_flow_gat', 'days_gat', 'days_gprs', 'days_call', 'nos_call', 'nos_calling', 'nos_calling_diff', 'sms_cnt', 'call_fee_local', 'call_fee_roam', 'gprs_income', 'gprs_fee', 'call_fee', 'gprs_flow_video', 'gprs_flow_short', 'gprs_flow_music', 'gprs_flow_commu', 'gprs_flow_game', 'score_flag_eg', 'score_flag_eg2', 'innet_date', 'last_stop_date', 'phone_no_null', 'phone_no_tm', 'dinner_id', 'account_id', 'sex', 'sex_add', 'user_status', 'dinner', 'if_nolimit', 'if_5g_dinner', 'if_5g_term', 'if_jt', 'start_level', 'if_cred_multi', 'term_model', 'term_brand', 'term_type', 'sk_type', 'if_new_term', 'flag_eg']
20220627-10:28:37      col_del: None
20220627-10:28:37      col_char(22): ['acct_month', 'phone_no_null', 'phone_no_tm', 'user_id', 'dinner_id', 'account_id', 'sex', 'sex_add', 'user_status', 'dinner', 'if_nolimit', 'if_5g_dinner', 'if_5g_term', 'if_jt', 'start_level', 'if_cred_multi', 'term_model', 'term_brand', 'term_type', 'sk_type', 'if_new_term', 'flag_eg']
20220627-10:28:37      col_num(45): ['innet_months', 'age', 'age_add', 'dinner_fee', 'gprs_last_defer', 'gprs_resource', 'gprs_now_rest', 'call_use', 'arpu', 'pay_cnt', 'pay_fee', 'acct_balance', 'calling_cnt', 'calling_dura', 'called_cnt', 'calling_diff_cnt', 'calling_diff_dura', 'gprs_flow', 'gprs_flow_4g', 'gprs_flow_5g', 'gprs_flow_busy', 'gprs_flow_idle', 'gprs_now_defer', 'gprs_flow_roam', 'call_dura_roam', 'gprs_flow_gat', 'days_gat', 'days_gprs', 'days_call', 'nos_call', 'nos_calling', 'nos_calling_diff', 'sms_cnt', 'call_fee_local', 'call_fee_roam', 'gprs_income', 'gprs_fee', 'call_fee', 'gprs_flow_video', 'gprs_flow_short', 'gprs_flow_music', 'gprs_flow_commu', 'gprs_flow_game', 'score_flag_eg', 'score_flag_eg2']
20220627-10:28:37      col_date(2): ['innet_date', 'last_stop_date']
20220627-10:28:37      nrows: None
20220627-10:28:37      if_coltolower: True
20220627-10:28:37      kwargs: {}

20220627-10:28:37      读取
20220627-10:28:41      shape: (7971, 71)

20220627-10:28:41  将score_flag_eg2字段类型(object): .astype(float)
20220627-10:28:41  -------------------------读取完毕: (7971, 71) 2022-06-27 10:28:41 -------------------------

20220627-10:28:41  手动衍生_py12个字段: {'monthsaready_last_stop_date': '最后停机时间：已发生时长', 'monthsremain_last_stop_date': '最后停机时间：剩余时长', 'days_gprs_p': '上网天数占比', 'days_call_p': '通话天数占比', 'days_call_p_1': '通话天数占比_1', 'days_call_p_2': '通话天数占比_2', 'days_call_p_3': '通话天数占比_3', 'days_call_p_4': '通话天数占比_4', 'greatest_gprs_app': 'app偏好', 'paste_dinner_innet_months': '主套餐、入网时长：交叉', 'ago_score_flag_eg': '模型示例的分数(历史)', 'ago_score_flag_eg2': '模型示例2的分数(历史)'}
20220627-10:28:41  monthsaready_last_stop_date: current_date - last_stop_date
20220627-10:28:41  monthsremain_last_stop_date: last_stop_date - current_date
20220627-10:28:41  days_gprs_p: days_gprs / days_month
20220627-10:28:41  days_call_p: days_call / days_month
20220627-10:28:41  days_call_p_1: days_call_p + days_gprs
20220627-10:28:41  days_call_p_2: days_call_p_1 + days_gprs
20220627-10:28:41  days_call_p_3: days_call_p_2 + days_gprs
20220627-10:28:41  days_call_p_4: days_call_p_3 + days_gprs
20220627-10:28:41  greatest_gprs_app: {'gprs_flow_video': 'video', 'gprs_flow_short': 'short', 'gprs_flow_music': 'music', 'gprs_flow_commu': 'commu', 'gprs_flow_game': 'game'}
20220627-10:28:46  paste_dinner_innet_months: (dinner, innet_months)
20220627-10:28:49  ago_score_flag_eg: {'notago_tovalue': 1}
20220627-10:28:49  ago_score_flag_eg2: {'notago_tovalue': 1}


Traceback (most recent call last):
  File "D:\Python for Windows\lib\site-packages\IPython\core\interactiveshell.py", line 3296, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File "<ipython-input-5-0749c49ff905>", line 2, in <module>
    exp, Info = tab_explore_create(base_train[model_name], Info, 'explore', src)
  File "D:\工作\模型脚本\ModelProject\selfmodule\tablemodule\tablefun.py", line 1866, in tab_explore_create
    data_recent, col_need_ad = manual_fun(data_recent, Info, field_manual)
  File "D:\工作\模型脚本\ModelProject\selfmodule\tablemodule\tablefun.py", line 1281, in manual_fun
    na_inf_examine(data_recent[field_manual.field_name])
  File "D:\工作\模型脚本\ModelProject\selfmodule\toolmodule\dataprep.py", line 142, in na_inf_examine
    raise Exception(s)
Exception: 数据存在缺失值或±inf，请检查！

缺失值：
ago_score_flag_eg2    4971
dtype: int64
20220627-10:30:52  开始时间：2022-06-27 10:30:52
20220627-10:30:52  参数设置：
                       step: train
                       stage: explore
                       Info.r_limit: 0.95
                       table_in: kehujingyingbudb.mid_eg_recent_train_202010
                       Info.iv_limit: 0.05
                       Info.auto_pair2: False
                       Info.model_name: 模型示例

20220627-10:30:52  field_base: 92行

20220627-10:30:52  删除7个available_notzd“不可用”字段：['cred_type', 'called_dura', 'days_roam', 'dayvalue_calling_dura', 'dayvalue_gprs_flow', 'dayvalue_user_status', 'dayvalue_phone_no_null']
20220627-10:30:52  field_base: 85行

20220627-10:30:52  删除1个基于“不可用”字段加工的手动衍生_py字段：
                        field_name                 formula
                   54  days_roam_p  days_roam / days_month
20220627-10:30:52  field_base: 84行


D:\工作\模型脚本\ModelProject\selfmodule\toolmodule\dataprep.py:9: UserWarning: Pipeline_DF：verbose参数值被赋予print_indent后默认参数设置为None
  import time


D:\工作\模型脚本\ModelProject\selfmodule\toolmodule\dataprep.py:9: UserWarning: FeatureUnion_DF：verbose参数值被赋予print_indent后默认参数设置为None
  import time
20220627-10:30:52  ------------------------- 读取数据: kehujingyingbudb.mid_eg_recent_train_202010 2022-06-27 10:30:52 -------------------------
20220627-10:30:52      src: gp
20220627-10:30:52      condition: data_use='data_train'
20220627-10:30:52      col_need(71): ['user_acct_month', 'data_use', 'acct_month', 'user_id', 'innet_months', 'age', 'age_add', 'dinner_fee', 'gprs_last_defer', 'gprs_resource', 'gprs_now_rest', 'call_use', 'arpu', 'pay_cnt', 'pay_fee', 'acct_balance', 'calling_cnt', 'calling_dura', 'called_cnt', 'calling_diff_cnt', 'calling_diff_dura', 'gprs_flow', 'gprs_flow_4g', 'gprs_flow_5g', 'gprs_flow_busy', 'gprs_flow_idle', 'gprs_now_defer', 'gprs_flow_roam', 'call_dura_roam', 'gprs_flow_gat', 'days_gat', 'days_gprs', 'days_call', 'nos_call', 'nos_calling', 'nos_calling_diff', 'sms_cnt', 'call_fee_local', 'call_fee_roam', 'gprs_income', 'gprs_fee', 'call_fee', 'gprs_flow_video', 'gprs_flow_short', 'gprs_flow_music', 'gprs_flow_commu', 'gprs_flow_game', 'score_flag_eg', 'score_flag_eg2', 'innet_date', 'last_stop_date', 'phone_no_null', 'phone_no_tm', 'dinner_id', 'account_id', 'sex', 'sex_add', 'user_status', 'dinner', 'if_nolimit', 'if_5g_dinner', 'if_5g_term', 'if_jt', 'start_level', 'if_cred_multi', 'term_model', 'term_brand', 'term_type', 'sk_type', 'if_new_term', 'flag_eg']
20220627-10:30:52      col_del: None
20220627-10:30:52      col_char(22): ['acct_month', 'phone_no_null', 'phone_no_tm', 'user_id', 'dinner_id', 'account_id', 'sex', 'sex_add', 'user_status', 'dinner', 'if_nolimit', 'if_5g_dinner', 'if_5g_term', 'if_jt', 'start_level', 'if_cred_multi', 'term_model', 'term_brand', 'term_type', 'sk_type', 'if_new_term', 'flag_eg']
20220627-10:30:52      col_num(45): ['innet_months', 'age', 'age_add', 'dinner_fee', 'gprs_last_defer', 'gprs_resource', 'gprs_now_rest', 'call_use', 'arpu', 'pay_cnt', 'pay_fee', 'acct_balance', 'calling_cnt', 'calling_dura', 'called_cnt', 'calling_diff_cnt', 'calling_diff_dura', 'gprs_flow', 'gprs_flow_4g', 'gprs_flow_5g', 'gprs_flow_busy', 'gprs_flow_idle', 'gprs_now_defer', 'gprs_flow_roam', 'call_dura_roam', 'gprs_flow_gat', 'days_gat', 'days_gprs', 'days_call', 'nos_call', 'nos_calling', 'nos_calling_diff', 'sms_cnt', 'call_fee_local', 'call_fee_roam', 'gprs_income', 'gprs_fee', 'call_fee', 'gprs_flow_video', 'gprs_flow_short', 'gprs_flow_music', 'gprs_flow_commu', 'gprs_flow_game', 'score_flag_eg', 'score_flag_eg2']
20220627-10:30:52      col_date(2): ['innet_date', 'last_stop_date']
20220627-10:30:52      nrows: None
20220627-10:30:52      if_coltolower: True
20220627-10:30:52      kwargs: {}

20220627-10:30:52      读取
20220627-10:30:56      shape: (7971, 71)

20220627-10:30:56  将score_flag_eg2字段类型(object): .astype(float)
20220627-10:30:56  -------------------------读取完毕: (7971, 71) 2022-06-27 10:30:56 -------------------------



Traceback (most recent call last):
  File "D:\Python for Windows\lib\site-packages\IPython\core\interactiveshell.py", line 3213, in run_ast_nodes
    code = compiler(mod, cell_name, "exec")
  File "D:\Python for Windows\lib\codeop.py", line 133, in __call__
    codeob = compile(source, filename, symbol, self.flags, 1)
  File "<ipython-input-11-9b5004e007d4>", line 2
SyntaxError: 'return' outside function
20220627-10:31:27  手动衍生_py12个字段: {'monthsaready_last_stop_date': '最后停机时间：已发生时长', 'monthsremain_last_stop_date': '最后停机时间：剩余时长', 'days_gprs_p': '上网天数占比', 'days_call_p': '通话天数占比', 'days_call_p_1': '通话天数占比_1', 'days_call_p_2': '通话天数占比_2', 'days_call_p_3': '通话天数占比_3', 'days_call_p_4': '通话天数占比_4', 'greatest_gprs_app': 'app偏好', 'paste_dinner_innet_months': '主套餐、入网时长：交叉', 'ago_score_flag_eg': '模型示例的分数(历史)', 'ago_score_flag_eg2': '模型示例2的分数(历史)'}
                   Out[13]: 20220627-10:31:33  range(0, 12)
                   Out[15]: 20220627-10:31:45  ('ago_score_flag_eg2', "{'notago_tovalue': 1}")
20220627-10:31:52  ago_score_flag_eg2: {'notago_tovalue': 1}
                   Out[20]: 20220627-10:32:24  True


Traceback (most recent call last):
  File "D:\Python for Windows\lib\site-packages\IPython\core\interactiveshell.py", line 3296, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File "<ipython-input-21-56ada8fe9b64>", line 3, in <module>
    na_inf_examine(data_recent[field_manual.field_name])
  File "D:\Python for Windows\lib\site-packages\pandas\core\frame.py", line 3464, in __getitem__
    indexer = self.loc._get_listlike_indexer(key, axis=1)[1]
  File "D:\Python for Windows\lib\site-packages\pandas\core\indexing.py", line 1314, in _get_listlike_indexer
    self._validate_read_indexer(keyarr, indexer, axis)
  File "D:\Python for Windows\lib\site-packages\pandas\core\indexing.py", line 1377, in _validate_read_indexer
    raise KeyError(f"{not_found} not in index")
KeyError: "['monthsaready_last_stop_date', 'monthsremain_last_stop_date', 'days_gprs_p', 'days_call_p', 'days_call_p_1', 'days_call_p_2', 'days_call_p_3', 'days_call_p_4', 'greatest_gprs_app', 'paste_dinner_innet_months', 'ago_score_flag_eg'] not in index"
                   Out[22]: 20220627-10:32:40  
                        user_acct_month    data_use acct_month      user_id  innet_months  age  age_add  dinner_fee  gprs_last_defer  gprs_resource  gprs_now_rest  call_use    arpu  pay_cnt  \
                   0             202010  data_train     202008  18992417187           143   38       38        18.0               10          20490            0.0     104.0  146.89        0   
                   1             202010  data_train     202008  13733501348           220   67       67        18.0              100         204810     10689883.0       NaN   18.00        0   
                   2             202010  data_train     202008  21311619084            69   50       50        78.0              191       42445945    157055648.0       3.0  108.90        0   
                   3             202010  data_train     202008  82505686878           168   60       60         6.0                0             10           10.0       0.0    6.30        0   
                   4             202010  data_train     202008  23857645661           189   66       66         8.0                0        5242890            2.0       0.0    8.10        0   
                   ...              ...         ...        ...          ...           ...  ...      ...         ...              ...            ...            ...       ...     ...      ...   
                   7966          202010  data_train     202010  24994319316           132   62       62         5.0               40             10        81920.0       NaN    5.00        0   
                   7967          202010  data_train     202010  11258314327           174   50       50        10.0              120       10690570     10730421.0      21.0   36.00        0   
                   7968          202010  data_train     202010  35984116187           204   75       75         0.0                0             10           10.0       NaN   13.35        0   
                   7969          202010  data_train     202010  23777067604            57   25       25        38.0              300         614410     11098008.0       2.0   38.00        0   
                   7970          202010  data_train     202010  28667734622           182   46       46        78.0               50         102410    104959979.0      30.0   78.00        0   
                   
                         pay_fee  ...  user_status                            dinner  if_nolimit  if_5g_dinner  if_5g_term  if_jt  start_level  if_cred_multi  term_model  term_brand  term_type  \
                   0         0.0  ...    在网-正常              神州行长途套餐18套餐          否            否          否     否         银卡              2    TAS-AL00        华为     4G手机   
                   1         0.0  ...    在网-正常  神州行家园卡4G飞享套餐升级版18档          否            否          是     否         三星              1    OXF-AN00        华为     4G手机   
                   2         0.0  ...    在网-正常            神州行畅听卡4G基本策划          否            否          否     否         二星              1      PBEM00        欧珀     4G手机   
                   3         0.0  ...    在网-正常        神州行家园卡大众套餐[策划]          否            否          否     否         一星              1    BLN-AL40        华为     4G手机   
                   4         0.0  ...    在网-正常                  全球通4G基本策划          否            否          是     是         三星              1    ELS-AN00        华为     4G手机   
                   ...       ...  ...          ...                               ...         ...           ...         ...    ...          ...            ...         ...         ...        ...   
                   7966      0.0  ...    在网-正常                    欢乐套餐2016版          否            否          否     否         三星              1    INE-AL00        华为     4G手机   
                   7967      0.0  ...    在网-正常                神州行畅听卡[策划]          否            否          否     否         三星              1      V1838A      步步高     4G手机   
                   7968      0.0  ...    在网-正常     神州行B标准资费基本策划[策划]          否            否          否     否         三星              1      PBCM30        欧珀     4G手机   
                   7969      0.0  ...    在网-正常            动感地带和4G套餐38套餐          否            否          否     否         一星              1    BKL-AL20        华为     4G手机   
                   7970      0.0  ...    在网-正常            动感地带上网套餐18套餐          否            否          否     否         三星              1    JKM-AL00        华为     4G手机   
                   
                          sk_type  if_new_term  flag_eg  ago_score_flag_eg2  
                   0     异网双卡           是     None                 NaN  
                   1         None           否     None                 NaN  
                   2     异网双卡           否     None                 NaN  
                   3         None           否     None                 NaN  
                   4         None           否     None                 NaN  
                   ...        ...          ...      ...                 ...  
                   7966      None           否        0                 1.0  
                   7967      None           否        0                 1.0  
                   7968      None           否        0                 1.0  
                   7969  异网双卡           否        0                 1.0  
                   7970  异网双卡           否        1                 1.0  
                   
                   [7971 rows x 72 columns]
                   Out[23]: 20220627-10:32:47  {'current_date', 'days_month'}
                   Out[24]: 20220627-10:32:53  
                   Index(['user_acct_month', 'data_use', 'acct_month', 'user_id', 'innet_months', 'age', 'age_add', 'dinner_fee', 'gprs_last_defer', 'gprs_resource', 'gprs_now_rest', 'call_use',
                          'arpu', 'pay_cnt', 'pay_fee', 'acct_balance', 'calling_cnt', 'calling_dura', 'called_cnt', 'calling_diff_cnt', 'calling_diff_dura', 'gprs_flow', 'gprs_flow_4g',
                          'gprs_flow_5g', 'gprs_flow_busy', 'gprs_flow_idle', 'gprs_now_defer', 'gprs_flow_roam', 'call_dura_roam', 'gprs_flow_gat', 'days_gat', 'days_gprs', 'days_call', 'nos_call',
                          'nos_calling', 'nos_calling_diff', 'sms_cnt', 'call_fee_local', 'call_fee_roam', 'gprs_income', 'gprs_fee', 'call_fee', 'gprs_flow_video', 'gprs_flow_short',
                          'gprs_flow_music', 'gprs_flow_commu', 'gprs_flow_game', 'score_flag_eg', 'score_flag_eg2', 'innet_date', 'last_stop_date', 'phone_no_null', 'phone_no_tm', 'dinner_id',
                          'account_id', 'sex', 'sex_add', 'user_status', 'dinner', 'if_nolimit', 'if_5g_dinner', 'if_5g_term', 'if_jt', 'start_level', 'if_cred_multi', 'term_model', 'term_brand',
                          'term_type', 'sk_type', 'if_new_term', 'flag_eg', 'ago_score_flag_eg2'],
                         dtype='object')
                   Out[25]: 20220627-10:33:22  set()
                   Out[26]: 20220627-10:33:36  
                   {'account_id',
                    'acct_balance',
                    'acct_month',
                    'age',
                    'age_add',
                    'ago_score_flag_eg2',
                    'arpu',
                    'call_dura_roam',
                    'call_fee',
                    'call_fee_local',
                    'call_fee_roam',
                    'call_use',
                    'called_cnt',
                    'calling_cnt',
                    'calling_diff_cnt',
                    'calling_diff_dura',
                    'calling_dura',
                    'data_use',
                    'days_call',
                    'days_gat',
                    'days_gprs',
                    'dinner',
                    'dinner_fee',
                    'dinner_id',
                    'flag_eg',
                    'gprs_fee',
                    'gprs_flow',
                    'gprs_flow_4g',
                    'gprs_flow_5g',
                    'gprs_flow_busy',
                    'gprs_flow_commu',
                    'gprs_flow_game',
                    'gprs_flow_gat',
                    'gprs_flow_idle',
                    'gprs_flow_music',
                    'gprs_flow_roam',
                    'gprs_flow_short',
                    'gprs_flow_video',
                    'gprs_income',
                    'gprs_last_defer',
                    'gprs_now_defer',
                    'gprs_now_rest',
                    'gprs_resource',
                    'if_5g_dinner',
                    'if_5g_term',
                    'if_cred_multi',
                    'if_jt',
                    'if_new_term',
                    'if_nolimit',
                    'innet_date',
                    'innet_months',
                    'last_stop_date',
                    'nos_call',
                    'nos_calling',
                    'nos_calling_diff',
                    'pay_cnt',
                    'pay_fee',
                    'phone_no_null',
                    'phone_no_tm',
                    'score_flag_eg',
                    'score_flag_eg2',
                    'sex',
                    'sex_add',
                    'sk_type',
                    'sms_cnt',
                    'start_level',
                    'term_brand',
                    'term_model',
                    'term_type',
                    'user_acct_month',
                    'user_id',
                    'user_status'}
                   Out[27]: 20220627-10:33:51  {'current_date', 'days_month'}
                   Out[28]: 20220627-10:34:04  set()


Traceback (most recent call last):
  File "D:\Python for Windows\lib\site-packages\IPython\core\interactiveshell.py", line 3296, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File "<ipython-input-29-cb1a36daef76>", line 1, in <module>
    v_else
NameError: name 'v_else' is not defined


Traceback (most recent call last):
  File "D:\Python for Windows\lib\site-packages\IPython\core\interactiveshell.py", line 3296, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File "<ipython-input-30-bec253940e9b>", line 1, in <module>
    data_recent[field_manual.field_name]
  File "D:\Python for Windows\lib\site-packages\pandas\core\frame.py", line 3464, in __getitem__
    indexer = self.loc._get_listlike_indexer(key, axis=1)[1]
  File "D:\Python for Windows\lib\site-packages\pandas\core\indexing.py", line 1314, in _get_listlike_indexer
    self._validate_read_indexer(keyarr, indexer, axis)
  File "D:\Python for Windows\lib\site-packages\pandas\core\indexing.py", line 1377, in _validate_read_indexer
    raise KeyError(f"{not_found} not in index")
KeyError: "['monthsaready_last_stop_date', 'monthsremain_last_stop_date', 'days_gprs_p', 'days_call_p', 'days_call_p_1', 'days_call_p_2', 'days_call_p_3', 'days_call_p_4', 'greatest_gprs_app', 'paste_dinner_innet_months', 'ago_score_flag_eg'] not in index"
                   Out[31]: 20220627-10:35:54  
                   14    monthsaready_last_stop_date
                   15    monthsremain_last_stop_date
                   60                    days_gprs_p
                   62                    days_call_p
                   63                  days_call_p_1
                   64                  days_call_p_2
                   65                  days_call_p_3
                   66                  days_call_p_4
                   81              greatest_gprs_app
                   82      paste_dinner_innet_months
                   91              ago_score_flag_eg
                   93             ago_score_flag_eg2
                   Name: field_name, dtype: object


Traceback (most recent call last):
  File "D:\Python for Windows\lib\site-packages\IPython\core\interactiveshell.py", line 3296, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File "<ipython-input-32-bec253940e9b>", line 1, in <module>
    data_recent[field_manual.field_name]
  File "D:\Python for Windows\lib\site-packages\pandas\core\frame.py", line 3464, in __getitem__
    indexer = self.loc._get_listlike_indexer(key, axis=1)[1]
  File "D:\Python for Windows\lib\site-packages\pandas\core\indexing.py", line 1314, in _get_listlike_indexer
    self._validate_read_indexer(keyarr, indexer, axis)
  File "D:\Python for Windows\lib\site-packages\pandas\core\indexing.py", line 1377, in _validate_read_indexer
    raise KeyError(f"{not_found} not in index")
KeyError: "['monthsaready_last_stop_date', 'monthsremain_last_stop_date', 'days_gprs_p', 'days_call_p', 'days_call_p_1', 'days_call_p_2', 'days_call_p_3', 'days_call_p_4', 'greatest_gprs_app', 'paste_dinner_innet_months', 'ago_score_flag_eg'] not in index"


Traceback (most recent call last):
  File "D:\Python for Windows\lib\site-packages\IPython\core\interactiveshell.py", line 3296, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File "<ipython-input-34-bec253940e9b>", line 1, in <module>
    data_recent[field_manual.field_name]
  File "D:\Python for Windows\lib\site-packages\pandas\core\frame.py", line 3464, in __getitem__
    indexer = self.loc._get_listlike_indexer(key, axis=1)[1]
  File "D:\Python for Windows\lib\site-packages\pandas\core\indexing.py", line 1314, in _get_listlike_indexer
    self._validate_read_indexer(keyarr, indexer, axis)
  File "D:\Python for Windows\lib\site-packages\pandas\core\indexing.py", line 1377, in _validate_read_indexer
    raise KeyError(f"{not_found} not in index")
KeyError: "['monthsaready_last_stop_date', 'monthsremain_last_stop_date', 'days_gprs_p', 'days_call_p', 'days_call_p_1', 'days_call_p_2', 'days_call_p_3', 'days_call_p_4', 'greatest_gprs_app', 'paste_dinner_innet_months', 'ago_score_flag_eg'] not in index"
20220627-10:37:59  ------------------------- 读取数据: kehujingyingbudb.mid_eg_recent_train_202010 2022-06-27 10:37:59 -------------------------
20220627-10:37:59      src: gp
20220627-10:37:59      condition: data_use='data_train'
20220627-10:37:59      col_need(71): ['user_acct_month', 'data_use', 'acct_month', 'user_id', 'innet_months', 'age', 'age_add', 'dinner_fee', 'gprs_last_defer', 'gprs_resource', 'gprs_now_rest', 'call_use', 'arpu', 'pay_cnt', 'pay_fee', 'acct_balance', 'calling_cnt', 'calling_dura', 'called_cnt', 'calling_diff_cnt', 'calling_diff_dura', 'gprs_flow', 'gprs_flow_4g', 'gprs_flow_5g', 'gprs_flow_busy', 'gprs_flow_idle', 'gprs_now_defer', 'gprs_flow_roam', 'call_dura_roam', 'gprs_flow_gat', 'days_gat', 'days_gprs', 'days_call', 'nos_call', 'nos_calling', 'nos_calling_diff', 'sms_cnt', 'call_fee_local', 'call_fee_roam', 'gprs_income', 'gprs_fee', 'call_fee', 'gprs_flow_video', 'gprs_flow_short', 'gprs_flow_music', 'gprs_flow_commu', 'gprs_flow_game', 'score_flag_eg', 'score_flag_eg2', 'innet_date', 'last_stop_date', 'phone_no_null', 'phone_no_tm', 'dinner_id', 'account_id', 'sex', 'sex_add', 'user_status', 'dinner', 'if_nolimit', 'if_5g_dinner', 'if_5g_term', 'if_jt', 'start_level', 'if_cred_multi', 'term_model', 'term_brand', 'term_type', 'sk_type', 'if_new_term', 'flag_eg']
20220627-10:37:59      col_del: None
20220627-10:37:59      col_char(22): ['acct_month', 'phone_no_null', 'phone_no_tm', 'user_id', 'dinner_id', 'account_id', 'sex', 'sex_add', 'user_status', 'dinner', 'if_nolimit', 'if_5g_dinner', 'if_5g_term', 'if_jt', 'start_level', 'if_cred_multi', 'term_model', 'term_brand', 'term_type', 'sk_type', 'if_new_term', 'flag_eg']
20220627-10:37:59      col_num(45): ['innet_months', 'age', 'age_add', 'dinner_fee', 'gprs_last_defer', 'gprs_resource', 'gprs_now_rest', 'call_use', 'arpu', 'pay_cnt', 'pay_fee', 'acct_balance', 'calling_cnt', 'calling_dura', 'called_cnt', 'calling_diff_cnt', 'calling_diff_dura', 'gprs_flow', 'gprs_flow_4g', 'gprs_flow_5g', 'gprs_flow_busy', 'gprs_flow_idle', 'gprs_now_defer', 'gprs_flow_roam', 'call_dura_roam', 'gprs_flow_gat', 'days_gat', 'days_gprs', 'days_call', 'nos_call', 'nos_calling', 'nos_calling_diff', 'sms_cnt', 'call_fee_local', 'call_fee_roam', 'gprs_income', 'gprs_fee', 'call_fee', 'gprs_flow_video', 'gprs_flow_short', 'gprs_flow_music', 'gprs_flow_commu', 'gprs_flow_game', 'score_flag_eg', 'score_flag_eg2']
20220627-10:37:59      col_date(2): ['innet_date', 'last_stop_date']
20220627-10:37:59      nrows: None
20220627-10:37:59      if_coltolower: True
20220627-10:37:59      kwargs: {}

20220627-10:37:59      读取
20220627-10:38:02      shape: (7971, 71)

20220627-10:38:02  将score_flag_eg2字段类型(object): .astype(float)
20220627-10:38:02  -------------------------读取完毕: (7971, 71) 2022-06-27 10:38:02 -------------------------

                   Out[36]: 20220627-10:38:10  12
20220627-10:38:19  手动衍生_py12个字段: {'monthsaready_last_stop_date': '最后停机时间：已发生时长', 'monthsremain_last_stop_date': '最后停机时间：剩余时长', 'days_gprs_p': '上网天数占比', 'days_call_p': '通话天数占比', 'days_call_p_1': '通话天数占比_1', 'days_call_p_2': '通话天数占比_2', 'days_call_p_3': '通话天数占比_3', 'days_call_p_4': '通话天数占比_4', 'greatest_gprs_app': 'app偏好', 'paste_dinner_innet_months': '主套餐、入网时长：交叉', 'ago_score_flag_eg': '模型示例的分数(历史)', 'ago_score_flag_eg2': '模型示例2的分数(历史)'}
                   Out[38]: 20220627-10:38:23  11
20220627-10:38:33  monthsaready_last_stop_date: current_date - last_stop_date
20220627-10:38:33  monthsremain_last_stop_date: last_stop_date - current_date
20220627-10:38:33  days_gprs_p: days_gprs / days_month
20220627-10:38:33  days_call_p: days_call / days_month
20220627-10:38:33  days_call_p_1: days_call_p + days_gprs
20220627-10:38:33  days_call_p_2: days_call_p_1 + days_gprs
20220627-10:38:33  days_call_p_3: days_call_p_2 + days_gprs
20220627-10:38:33  days_call_p_4: days_call_p_3 + days_gprs
20220627-10:38:33  greatest_gprs_app: {'gprs_flow_video': 'video', 'gprs_flow_short': 'short', 'gprs_flow_music': 'music', 'gprs_flow_commu': 'commu', 'gprs_flow_game': 'game'}
20220627-10:38:38  paste_dinner_innet_months: (dinner, innet_months)


D:\工作\模型脚本\ModelProject\selfmodule\tablemodule\tablefun.py:1020: UserWarning: opera_pair_fun paste时存在非类别型字段，请确认: ['innet_months']
  warnings.warn(s); time.sleep(seconds)
20220627-10:38:41  ago_score_flag_eg: {'notago_tovalue': 1}
20220627-10:38:41  ago_score_flag_eg2: {'notago_tovalue': 1}
                   Out[41]: 20220627-10:38:50  
                        user_acct_month    data_use acct_month      user_id  innet_months  age  age_add  dinner_fee  gprs_last_defer  gprs_resource  gprs_now_rest  call_use    arpu  pay_cnt  \
                   0             202010  data_train     202008  18992417187           143   38       38        18.0               10          20490            0.0     104.0  146.89        0   
                   1             202010  data_train     202008  13733501348           220   67       67        18.0              100         204810     10689883.0       NaN   18.00        0   
                   2             202010  data_train     202008  21311619084            69   50       50        78.0              191       42445945    157055648.0       3.0  108.90        0   
                   3             202010  data_train     202008  82505686878           168   60       60         6.0                0             10           10.0       0.0    6.30        0   
                   4             202010  data_train     202008  23857645661           189   66       66         8.0                0        5242890            2.0       0.0    8.10        0   
                   ...              ...         ...        ...          ...           ...  ...      ...         ...              ...            ...            ...       ...     ...      ...   
                   7966          202010  data_train     202010  24994319316           132   62       62         5.0               40             10        81920.0       NaN    5.00        0   
                   7967          202010  data_train     202010  11258314327           174   50       50        10.0              120       10690570     10730421.0      21.0   36.00        0   
                   7968          202010  data_train     202010  35984116187           204   75       75         0.0                0             10           10.0       NaN   13.35        0   
                   7969          202010  data_train     202010  23777067604            57   25       25        38.0              300         614410     11098008.0       2.0   38.00        0   
                   7970          202010  data_train     202010  28667734622           182   46       46        78.0               50         102410    104959979.0      30.0   78.00        0   
                   
                         pay_fee  ...   sk_type  if_new_term  flag_eg  monthsaready_last_stop_date  monthsremain_last_stop_date  days_gprs_p  days_call_p  days_call_p_1  days_call_p_2  \
                   0         0.0  ...  异网双卡           是     None                         16.0                        -16.0     0.967742     0.967742      30.967742      60.967742   
                   1         0.0  ...      None           否     None                          0.0                         -0.0     0.967742     0.161290      30.161290      60.161290   
                   2         0.0  ...  异网双卡           否     None                         51.0                        -51.0     0.967742     0.193548      30.193548      60.193548   
                   3         0.0  ...      None           否     None                         25.0                        -25.0     0.193548     0.612903       6.612903      12.612903   
                   4         0.0  ...      None           否     None                          5.0                         -5.0     0.967742     0.645161      30.645161      60.645161   
                   ...       ...  ...       ...          ...      ...                          ...                          ...          ...          ...            ...            ...   
                   7966      0.0  ...      None           否        0                         19.0                        -19.0     1.000000     0.548387      31.548387      62.548387   
                   7967      0.0  ...      None           否        0                         17.0                        -17.0     1.000000     0.290323      31.290323      62.290323   
                   7968      0.0  ...      None           否        0                         22.0                        -22.0     0.000000     0.612903       0.612903       0.612903   
                   7969      0.0  ...  异网双卡           否        0                         12.0                        -12.0     1.000000     0.516129      31.516129      62.516129   
                   7970      0.0  ...  异网双卡           否        1                         65.0                        -65.0     1.000000     0.645161      31.645161      62.645161   
                   
                         days_call_p_3  days_call_p_4  greatest_gprs_app             paste_dinner_innet_months  ago_score_flag_eg  ago_score_flag_eg2  
                   0         90.967742     120.967742              video              神州行长途套餐18套餐_143             64.088                 NaN  
                   1         90.161290     120.161290              video  神州行家园卡4G飞享套餐升级版18档_220             46.979                 NaN  
                   2         90.193548     120.193548              video             神州行畅听卡4G基本策划_69             45.040                 NaN  
                   3         18.612903      24.612903              video        神州行家园卡大众套餐[策划]_168             55.835                 NaN  
                   4         90.645161     120.645161              video                  全球通4G基本策划_189             49.289                 NaN  
                   ...             ...            ...                ...                                   ...                ...                 ...  
                   7966      93.548387     124.548387              video                    欢乐套餐2016版_132              1.000                 1.0  
                   7967      93.290323     124.290323              video                神州行畅听卡[策划]_174              1.000                 1.0  
                   7968       0.612903       0.612903              video     神州行B标准资费基本策划[策划]_204              1.000                 1.0  
                   7969      93.516129     124.516129              video             动感地带和4G套餐38套餐_57              1.000                 1.0  
                   7970      93.645161     124.645161              video            动感地带上网套餐18套餐_182              1.000                 1.0  
                   
                   [7971 rows x 83 columns]
                   Out[42]: 20220627-10:38:57  set()
                   Out[43]: 20220627-10:39:05  
                         monthsaready_last_stop_date  monthsremain_last_stop_date  days_gprs_p  days_call_p  days_call_p_1  days_call_p_2  days_call_p_3  days_call_p_4 greatest_gprs_app  \
                   0                            16.0                        -16.0     0.967742     0.967742      30.967742      60.967742      90.967742     120.967742             video   
                   1                             0.0                         -0.0     0.967742     0.161290      30.161290      60.161290      90.161290     120.161290             video   
                   2                            51.0                        -51.0     0.967742     0.193548      30.193548      60.193548      90.193548     120.193548             video   
                   3                            25.0                        -25.0     0.193548     0.612903       6.612903      12.612903      18.612903      24.612903             video   
                   4                             5.0                         -5.0     0.967742     0.645161      30.645161      60.645161      90.645161     120.645161             video   
                   ...                           ...                          ...          ...          ...            ...            ...            ...            ...               ...   
                   7966                         19.0                        -19.0     1.000000     0.548387      31.548387      62.548387      93.548387     124.548387             video   
                   7967                         17.0                        -17.0     1.000000     0.290323      31.290323      62.290323      93.290323     124.290323             video   
                   7968                         22.0                        -22.0     0.000000     0.612903       0.612903       0.612903       0.612903       0.612903             video   
                   7969                         12.0                        -12.0     1.000000     0.516129      31.516129      62.516129      93.516129     124.516129             video   
                   7970                         65.0                        -65.0     1.000000     0.645161      31.645161      62.645161      93.645161     124.645161             video   
                   
                                    paste_dinner_innet_months  ago_score_flag_eg  ago_score_flag_eg2  
                   0                 神州行长途套餐18套餐_143             64.088                 NaN  
                   1     神州行家园卡4G飞享套餐升级版18档_220             46.979                 NaN  
                   2                神州行畅听卡4G基本策划_69             45.040                 NaN  
                   3           神州行家园卡大众套餐[策划]_168             55.835                 NaN  
                   4                     全球通4G基本策划_189             49.289                 NaN  
                   ...                                    ...                ...                 ...  
                   7966                    欢乐套餐2016版_132              1.000                 1.0  
                   7967                神州行畅听卡[策划]_174              1.000                 1.0  
                   7968     神州行B标准资费基本策划[策划]_204              1.000                 1.0  
                   7969             动感地带和4G套餐38套餐_57              1.000                 1.0  
                   7970            动感地带上网套餐18套餐_182              1.000                 1.0  
                   
                   [7971 rows x 12 columns]


Traceback (most recent call last):
  File "D:\Python for Windows\lib\site-packages\IPython\core\interactiveshell.py", line 3296, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File "<ipython-input-46-bb26fe6bf454>", line 7, in <module>
    raise Exception(s)
Exception: 数据存在缺失值或±inf，请检查！

缺失值：
ago_score_flag_eg2    4971
dtype: int64
                   Out[48]: 20220627-10:40:03  Series([], dtype: int64)
                   Out[50]: 20220627-10:40:27  True
                   Out[51]: 20220627-10:41:51  
                         monthsaready_last_stop_date  monthsremain_last_stop_date  days_gprs_p  days_call_p  days_call_p_1  days_call_p_2  days_call_p_3  days_call_p_4 greatest_gprs_app  \
                   0                            16.0                        -16.0     0.967742     0.967742      30.967742      60.967742      90.967742     120.967742             video   
                   1                             0.0                         -0.0     0.967742     0.161290      30.161290      60.161290      90.161290     120.161290             video   
                   2                            51.0                        -51.0     0.967742     0.193548      30.193548      60.193548      90.193548     120.193548             video   
                   3                            25.0                        -25.0     0.193548     0.612903       6.612903      12.612903      18.612903      24.612903             video   
                   4                             5.0                         -5.0     0.967742     0.645161      30.645161      60.645161      90.645161     120.645161             video   
                   ...                           ...                          ...          ...          ...            ...            ...            ...            ...               ...   
                   7966                         19.0                        -19.0     1.000000     0.548387      31.548387      62.548387      93.548387     124.548387             video   
                   7967                         17.0                        -17.0     1.000000     0.290323      31.290323      62.290323      93.290323     124.290323             video   
                   7968                         22.0                        -22.0     0.000000     0.612903       0.612903       0.612903       0.612903       0.612903             video   
                   7969                         12.0                        -12.0     1.000000     0.516129      31.516129      62.516129      93.516129     124.516129             video   
                   7970                         65.0                        -65.0     1.000000     0.645161      31.645161      62.645161      93.645161     124.645161             video   
                   
                                    paste_dinner_innet_months  ago_score_flag_eg  ago_score_flag_eg2  
                   0                 神州行长途套餐18套餐_143             64.088                 NaN  
                   1     神州行家园卡4G飞享套餐升级版18档_220             46.979                 NaN  
                   2                神州行畅听卡4G基本策划_69             45.040                 NaN  
                   3           神州行家园卡大众套餐[策划]_168             55.835                 NaN  
                   4                     全球通4G基本策划_189             49.289                 NaN  
                   ...                                    ...                ...                 ...  
                   7966                    欢乐套餐2016版_132              1.000                 1.0  
                   7967                神州行畅听卡[策划]_174              1.000                 1.0  
                   7968     神州行B标准资费基本策划[策划]_204              1.000                 1.0  
                   7969             动感地带和4G套餐38套餐_57              1.000                 1.0  
                   7970            动感地带上网套餐18套餐_182              1.000                 1.0  
                   
                   [7971 rows x 12 columns]
20220627-11:01:48  ------------------------- 读取数据: kehujingyingbudb.mid_eg_recent_train_202010 2022-06-27 11:01:48 -------------------------
20220627-11:01:48      src: gp
20220627-11:01:48      condition: data_use='data_train'
20220627-11:01:48      col_need(71): ['user_acct_month', 'data_use', 'acct_month', 'user_id', 'innet_months', 'age', 'age_add', 'dinner_fee', 'gprs_last_defer', 'gprs_resource', 'gprs_now_rest', 'call_use', 'arpu', 'pay_cnt', 'pay_fee', 'acct_balance', 'calling_cnt', 'calling_dura', 'called_cnt', 'calling_diff_cnt', 'calling_diff_dura', 'gprs_flow', 'gprs_flow_4g', 'gprs_flow_5g', 'gprs_flow_busy', 'gprs_flow_idle', 'gprs_now_defer', 'gprs_flow_roam', 'call_dura_roam', 'gprs_flow_gat', 'days_gat', 'days_gprs', 'days_call', 'nos_call', 'nos_calling', 'nos_calling_diff', 'sms_cnt', 'call_fee_local', 'call_fee_roam', 'gprs_income', 'gprs_fee', 'call_fee', 'gprs_flow_video', 'gprs_flow_short', 'gprs_flow_music', 'gprs_flow_commu', 'gprs_flow_game', 'score_flag_eg', 'score_flag_eg2', 'innet_date', 'last_stop_date', 'phone_no_null', 'phone_no_tm', 'dinner_id', 'account_id', 'sex', 'sex_add', 'user_status', 'dinner', 'if_nolimit', 'if_5g_dinner', 'if_5g_term', 'if_jt', 'start_level', 'if_cred_multi', 'term_model', 'term_brand', 'term_type', 'sk_type', 'if_new_term', 'flag_eg']
20220627-11:01:48      col_del: None
20220627-11:01:48      col_char(22): ['acct_month', 'phone_no_null', 'phone_no_tm', 'user_id', 'dinner_id', 'account_id', 'sex', 'sex_add', 'user_status', 'dinner', 'if_nolimit', 'if_5g_dinner', 'if_5g_term', 'if_jt', 'start_level', 'if_cred_multi', 'term_model', 'term_brand', 'term_type', 'sk_type', 'if_new_term', 'flag_eg']
20220627-11:01:48      col_num(45): ['innet_months', 'age', 'age_add', 'dinner_fee', 'gprs_last_defer', 'gprs_resource', 'gprs_now_rest', 'call_use', 'arpu', 'pay_cnt', 'pay_fee', 'acct_balance', 'calling_cnt', 'calling_dura', 'called_cnt', 'calling_diff_cnt', 'calling_diff_dura', 'gprs_flow', 'gprs_flow_4g', 'gprs_flow_5g', 'gprs_flow_busy', 'gprs_flow_idle', 'gprs_now_defer', 'gprs_flow_roam', 'call_dura_roam', 'gprs_flow_gat', 'days_gat', 'days_gprs', 'days_call', 'nos_call', 'nos_calling', 'nos_calling_diff', 'sms_cnt', 'call_fee_local', 'call_fee_roam', 'gprs_income', 'gprs_fee', 'call_fee', 'gprs_flow_video', 'gprs_flow_short', 'gprs_flow_music', 'gprs_flow_commu', 'gprs_flow_game', 'score_flag_eg', 'score_flag_eg2']
20220627-11:01:48      col_date(2): ['innet_date', 'last_stop_date']
20220627-11:01:48      nrows: None
20220627-11:01:48      if_coltolower: True
20220627-11:01:48      kwargs: {}

20220627-11:01:48      读取
20220627-11:01:54      shape: (7971, 71)

20220627-11:01:54  将score_flag_eg2字段类型(object): .astype(float)
20220627-11:01:54  -------------------------读取完毕: (7971, 71) 2022-06-27 11:01:54 -------------------------

                   Out[53]: 20220627-11:01:59  
                         user_acct_month    data_use acct_month      user_id  innet_months  age  age_add  dinner_fee  gprs_last_defer  gprs_resource  gprs_now_rest  call_use    arpu  pay_cnt  \
                   0              202010  data_train     202008  18992417187           143   38       38        18.0               10          20490            0.0     104.0  146.89        0   
                   1              202010  data_train     202008  13733501348           220   67       67        18.0              100         204810     10689883.0       NaN   18.00        0   
                   2              202010  data_train     202008  21311619084            69   50       50        78.0              191       42445945    157055648.0       3.0  108.90        0   
                   3              202010  data_train     202008  82505686878           168   60       60         6.0                0             10           10.0       0.0    6.30        0   
                   4              202010  data_train     202008  23857645661           189   66       66         8.0                0        5242890            2.0       0.0    8.10        0   
                   ...               ...         ...        ...          ...           ...  ...      ...         ...              ...            ...            ...       ...     ...      ...   
                   7966           202010  data_train     202010  24994319316           132   62       62         5.0               40             10        81920.0       NaN    5.00        0   
                   7967           202010  data_train     202010  11258314327           174   50       50        10.0              120       10690570     10730421.0      21.0   36.00        0   
                   7968           202010  data_train     202010  35984116187           204   75       75         0.0                0             10           10.0       NaN   13.35        0   
                   7969           202010  data_train     202010  23777067604            57   25       25        38.0              300         614410     11098008.0       2.0   38.00        0   
                   7970           202010  data_train     202010  28667734622           182   46       46        78.0               50         102410    104959979.0      30.0   78.00        0   
                   
                         pay_fee  ...  sex_add  user_status                            dinner  if_nolimit  if_5g_dinner  if_5g_term  if_jt  start_level  if_cred_multi  term_model  term_brand  \
                   0         0.0  ...       男    在网-正常              神州行长途套餐18套餐          否            否          否     否         银卡              2    TAS-AL00        华为   
                   1         0.0  ...       男    在网-正常  神州行家园卡4G飞享套餐升级版18档          否            否          是     否         三星              1    OXF-AN00        华为   
                   2         0.0  ...       女    在网-正常            神州行畅听卡4G基本策划          否            否          否     否         二星              1      PBEM00        欧珀   
                   3         0.0  ...       男    在网-正常        神州行家园卡大众套餐[策划]          否            否          否     否         一星              1    BLN-AL40        华为   
                   4         0.0  ...       女    在网-正常                  全球通4G基本策划          否            否          是     是         三星              1    ELS-AN00        华为   
                   ...       ...  ...      ...          ...                               ...         ...           ...         ...    ...          ...            ...         ...         ...   
                   7966      0.0  ...       女    在网-正常                    欢乐套餐2016版          否            否          否     否         三星              1    INE-AL00        华为   
                   7967      0.0  ...       女    在网-正常                神州行畅听卡[策划]          否            否          否     否         三星              1      V1838A      步步高   
                   7968      0.0  ...       女    在网-正常     神州行B标准资费基本策划[策划]          否            否          否     否         三星              1      PBCM30        欧珀   
                   7969      0.0  ...       男    在网-正常            动感地带和4G套餐38套餐          否            否          否     否         一星              1    BKL-AL20        华为   
                   7970      0.0  ...       女    在网-正常            动感地带上网套餐18套餐          否            否          否     否         三星              1    JKM-AL00        华为   
                   
                         term_type   sk_type  if_new_term  flag_eg  
                   0        4G手机  异网双卡           是     None  
                   1        4G手机      None           否     None  
                   2        4G手机  异网双卡           否     None  
                   3        4G手机      None           否     None  
                   4        4G手机      None           否     None  
                   ...         ...       ...          ...      ...  
                   7966     4G手机      None           否        0  
                   7967     4G手机      None           否        0  
                   7968     4G手机      None           否        0  
                   7969     4G手机  异网双卡           否        0  
                   7970     4G手机  异网双卡           否        1  
                   
                   [7971 rows x 71 columns]
                   Out[54]: 20220627-11:02:19  
                   Index(['user_acct_month', 'data_use', 'acct_month', 'user_id', 'innet_months', 'age', 'age_add', 'dinner_fee', 'gprs_last_defer', 'gprs_resource', 'gprs_now_rest', 'call_use',
                          'arpu', 'pay_cnt', 'pay_fee', 'acct_balance', 'calling_cnt', 'calling_dura', 'called_cnt', 'calling_diff_cnt', 'calling_diff_dura', 'gprs_flow', 'gprs_flow_4g',
                          'gprs_flow_5g', 'gprs_flow_busy', 'gprs_flow_idle', 'gprs_now_defer', 'gprs_flow_roam', 'call_dura_roam', 'gprs_flow_gat', 'days_gat', 'days_gprs', 'days_call', 'nos_call',
                          'nos_calling', 'nos_calling_diff', 'sms_cnt', 'call_fee_local', 'call_fee_roam', 'gprs_income', 'gprs_fee', 'call_fee', 'gprs_flow_video', 'gprs_flow_short',
                          'gprs_flow_music', 'gprs_flow_commu', 'gprs_flow_game', 'score_flag_eg', 'score_flag_eg2', 'innet_date', 'last_stop_date', 'phone_no_null', 'phone_no_tm', 'dinner_id',
                          'account_id', 'sex', 'sex_add', 'user_status', 'dinner', 'if_nolimit', 'if_5g_dinner', 'if_5g_term', 'if_jt', 'start_level', 'if_cred_multi', 'term_model', 'term_brand',
                          'term_type', 'sk_type', 'if_new_term', 'flag_eg'],
                         dtype='object')
                   Out[55]: 20220627-11:02:41  
                   0      NaN
                   1      NaN
                   2      NaN
                   3      NaN
                   4      NaN
                           ..
                   7966   NaN
                   7967   NaN
                   7968   NaN
                   7969   NaN
                   7970   NaN
                   Name: score_flag_eg2, Length: 7971, dtype: float64
                   Out[57]: 20220627-11:02:57  
                   0      NaN
                   1      NaN
                   2      NaN
                   3      NaN
                   4      NaN
                           ..
                   7966   NaN
                   7967   NaN
                   7968   NaN
                   7969   NaN
                   7970   NaN
                   Name: score_flag_eg2, Length: 7971, dtype: float64
                   Out[59]: 20220627-11:03:32  Series([], Name: field_name, dtype: object)
                   Out[60]: 20220627-11:05:05  'ml.table_score_month'
                   Out[61]: 
                      s_field_base    tabletype                                       tablename alias                             on                                    tableXday_desc  \
                   0     s_yw_fake   tableXmain      kehujingyingbudb.ml_feature_info_yw_user_m    x0                           主表                                               NaN   
                   1     s_yw_fake    tableXadd       kehujingyingbudb.ml_feature_add_yw_user_m    x1        x0.user_id = x1.user_id                                               NaN   
                   2     s_yw_fake    tableXday    kehujingyingbudb.ml_feature_info_yw_user_day    d1        x0.user_id = d1.user_id  {"col_day": 'acct_day', 'monthadd': 1, 'dd': 15}   
                   3     s_yw_fake  tableXscore                            ml.table_score_month     s         x0.user_id = s.user_id                                               NaN   
                   4     s_yw_fake       tableY       kehujingyingbudb.ml_target_info_yw_user_m     y         x0.user_id = y.user_id                                               NaN   
                   5     s_yw_team   tableXmain    kehujingyingbudb.dm_zc_yw_moxing_team_info_m    x0                           主表                                               NaN   
                   6     s_yw_team    tableXadd     kehujingyingbudb.dm_zc_yw_moxing_team_add_m    x1  x0.zk_user_no = x1.zk_user_no                                               NaN   
                   7     s_yw_team  tableXscore         kehujingyingbudb.binaryclassify_score_m     s      x0.zk_user_no = s.user_no                                               NaN   
                   8     s_yw_team    tableXday                       edww.dww_d_pr_pri_al_inst    d1     x0.zk_user_no = d1.user_no    {"col_day": 'day_id', 'monthadd': 1, 'dd': 15}   
                   9     s_yw_team       tableY  kehujingyingbudb.dm_zc_yw_moxing_team_target_m     y   x0.zk_user_no = y.zk_user_no                                               NaN   
                   10    s_kd_user   tableXmain         kehujingyingbudb.dm_zc_kd_moxing_info_m    x0                           主表                                               NaN   
                   11    s_kd_user       tableY       kehujingyingbudb.dm_zc_kd_moxing_target_m     y         x0.user_no = y.user_no                                               NaN   
                   12    s_kd_user    tableXday                       edww.dww_d_pr_pri_al_inst    d1        x0.user_no = d1.user_no    {"col_day": 'day_id', 'monthadd': 1, 'dd': 15}   
                   13    s_rh_team   tableXmain    kehujingyingbudb.dm_zc_rh_moxing_team_info_m    x0                           主表                                               NaN   
                   14    s_rh_team    tableXadd     kehujingyingbudb.dm_zc_yw_moxing_team_add_m    x1  x0.zk_user_no = x1.zk_user_no                                               NaN   
                   15    s_rh_team  tableXscore         kehujingyingbudb.binaryclassify_score_m     s      x0.zk_user_no = s.user_no                                               NaN   
                   16    s_rh_team       tableY  kehujingyingbudb.dm_zc_yw_moxing_team_target_m     y   x0.zk_user_no = y.zk_user_no                                               NaN   
                   17    s_rh_team    tableXday                       edww.dww_d_pr_pri_al_inst    d1     x0.zk_user_no = d1.user_no    {"col_day": 'day_id', 'monthadd': 1, 'dd': 15}   
                   18    s_yw_user   tableXmain         kehujingyingbudb.dm_zc_yw_moxing_info_m    x0                           主表                                               NaN   
                   19    s_yw_user  tableXscore         kehujingyingbudb.binaryclassify_score_m     s         x0.user_no = s.user_no                                               NaN   
                   20    s_yw_user       tableY       kehujingyingbudb.dm_zc_yw_moxing_target_m     y         x0.user_no = y.user_no                                               NaN   
                   
                           tableXscore_desc  
                   0                    NaN  
                   1                    NaN  
                   2                    NaN  
                   3   {'if_unpivot': True}  
                   4                    NaN  
                   5                    NaN  
                   6                    NaN  
                   7   {'if_unpivot': True}  
                   8                    NaN  
                   9                    NaN  
                   10                   NaN  
                   11                   NaN  
                   12                   NaN  
                   13                   NaN  
                   14                   NaN  
                   15                   NaN  
                   16                   NaN  
                   17                   NaN  
                   18                   NaN  
                   19                   NaN  
                   20                   NaN  
